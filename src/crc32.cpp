/*
This file is part of "UFO 2000" aka "X-COM: Gladiators"
                    http://ufo2000.sourceforge.net/
Copyright (C) 2000-2001  Alexander Ivanov aka Sanami
Copyright (C) 2002       ufo2000 development team

This program is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; either version 2 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
*/
#include "global.h"
#include <stdio.h>
#include <vector>
#include <string>
#include "pfxopen.h"

/**
 * Table needed to check data files integrity
 */
struct { const char *mName; unsigned long mCrc32; } DataFilesCrc32[] =
{
    { "./geodata.dat", 0x00000000 },
    { "./soldier.dat", 0x00000000 },
    { "./armoury.set", 0x00000000 },
    { "./items.dat", 0x00000000 },
    { "./ufo2000.ini", 0x00000000 },
    { "./ufo2000.dat", 0x8809A765 },

    { "./sound/sound1.cat", 0x514BD2C6 },
    { "./sound/sound2.cat", 0x432F7EBF },

    { "./geodata/biglets.dat", 0xEBC00F20 },
    { "./geodata/loftemps.dat", 0x7B354479 },
    { "./geodata/obdata.dat", 0x040A286A },
    { "./geodata/palettes.dat", 0x928554F0 },
    { "./geodata/scang.dat", 0x26C1BD1B },
    { "./geodata/smallset.dat", 0x0402BDDF },
    { "./geograph/back01.scr", 0xD071E645 },
    { "./geograph/back03.scr", 0x8098231A },
    { "./geograph/back09.scr", 0xF7A94FD1 },
    { "./geograph/back14.scr", 0x7AF63F1D },
    { "./maps/avenger.map", 0x90ABB3A2 },
    { "./maps/culta00.map", 0x6ABEDB57 },
    { "./maps/culta01.map", 0xD3741B8F },
    { "./maps/culta02.map", 0x31D938AD },
    { "./maps/culta03.map", 0x5F2FBC28 },
    { "./maps/culta04.map", 0x1370D991 },
    { "./maps/culta05.map", 0x5A85CEFF },
    { "./maps/culta06.map", 0x2D14B522 },
    { "./maps/culta07.map", 0x8581F7BC },
    { "./maps/culta08.map", 0x818587B6 },
    { "./maps/culta09.map", 0xCFA0BD4E },
    { "./maps/culta10.map", 0xD951E8A3 },
    { "./maps/culta11.map", 0xA7E2D4DF },
    { "./maps/culta12.map", 0x797DE4D0 },
    { "./maps/culta13.map", 0x52B19D8C },
    { "./maps/culta14.map", 0xC82850D6 },
    { "./maps/culta15.map", 0xB0792837 },
    { "./maps/culta16.map", 0x16865E09 },
    { "./maps/culta17.map", 0x8143A65F },
    { "./maps/culta18.map", 0xE790392B },
    { "./maps/desert00.map", 0x11C77179 },
    { "./maps/desert01.map", 0xC4C69939 },
    { "./maps/desert02.map", 0x47FE7961 },
    { "./maps/desert03.map", 0xCF6A6049 },
    { "./maps/desert04.map", 0xDF5CBAC7 },
    { "./maps/desert05.map", 0xF0691090 },
    { "./maps/desert06.map", 0x0C015DCB },
    { "./maps/desert07.map", 0x4288A717 },
    { "./maps/desert08.map", 0x3E8BF60B },
    { "./maps/desert09.map", 0x97C2BF82 },
    { "./maps/desert10.map", 0xE3959523 },
    { "./maps/desert11.map", 0xB2C2492D },
    { "./maps/forest00.map", 0xC338E845 },
    { "./maps/forest01.map", 0x1C331A17 },
    { "./maps/forest02.map", 0x78E3B674 },
    { "./maps/forest03.map", 0xE953A70D },
    { "./maps/forest04.map", 0x599E86B3 },
    { "./maps/forest05.map", 0x8B3ADF7A },
    { "./maps/forest06.map", 0x762FEF57 },
    { "./maps/forest07.map", 0x656B33B1 },
    { "./maps/forest08.map", 0xCE06B609 },
    { "./maps/forest09.map", 0xAA56F5A4 },
    { "./maps/forest10.map", 0xC08AAF5A },
    { "./maps/forest11.map", 0x2015A3CC },
    { "./maps/jungle00.map", 0x880F7427 },
    { "./maps/jungle01.map", 0xCE19F532 },
    { "./maps/jungle02.map", 0x1D306B51 },
    { "./maps/jungle03.map", 0xB370DB8C },
    { "./maps/jungle04.map", 0xE7AC70B2 },
    { "./maps/jungle05.map", 0xB7656AEE },
    { "./maps/jungle06.map", 0x0745E2F4 },
    { "./maps/jungle07.map", 0xFD8E6124 },
    { "./maps/jungle08.map", 0x0989CE29 },
    { "./maps/jungle09.map", 0x604637BE },
    { "./maps/jungle10.map", 0xAB88C604 },
    { "./maps/jungle11.map", 0xBE12E660 },
    { "./maps/lightnin.map", 0x40093C09 },
    { "./maps/map3.map", 0xD714860E },
    { "./maps/map4.map", 0xA19FD2C9 },
    { "./maps/mars00.map", 0xFF00CC89 },
    { "./maps/mars01.map", 0xC39934F3 },
    { "./maps/mars02.map", 0x93ABC813 },
    { "./maps/mars03.map", 0xA2C1CC10 },
    { "./maps/mars04.map", 0xC379FB00 },
    { "./maps/mars05.map", 0xE16C2B89 },
    { "./maps/mars06.map", 0x96907559 },
    { "./maps/mars07.map", 0xF29B8D08 },
    { "./maps/mars08.map", 0xF77C60BB },
    { "./maps/mars09.map", 0xFADEF47F },
    { "./maps/mars10.map", 0x08B57FF4 },
    { "./maps/mount00.map", 0xC407A34F },
    { "./maps/mount01.map", 0x24FADF8C },
    { "./maps/mount02.map", 0x8809A13B },
    { "./maps/mount03.map", 0xDA4203CF },
    { "./maps/mount04.map", 0x4822762C },
    { "./maps/mount05.map", 0x7C56F636 },
    { "./maps/mount06.map", 0xCEB5B4E1 },
    { "./maps/mount07.map", 0xCC7F87A0 },
    { "./maps/mount08.map", 0xB44EC383 },
    { "./maps/mount09.map", 0xB2D3D1B9 },
    { "./maps/mount10.map", 0x33A83882 },
    { "./maps/mount11.map", 0x7529D45C },
    { "./maps/mount12.map", 0xC6AD3F14 },
    { "./maps/pabduct.map", 0x88C559DC },
    { "./maps/pharvest.map", 0x2D610549 },
    { "./maps/plane.map", 0xB8639476 },
    { "./maps/polar00.map", 0x4EF18423 },
    { "./maps/polar01.map", 0x5F6D39A7 },
    { "./maps/polar02.map", 0x8FEA4018 },
    { "./maps/polar03.map", 0xB3CAD4FC },
    { "./maps/polar04.map", 0x610C92B4 },
    { "./maps/polar05.map", 0x60654420 },
    { "./maps/polar06.map", 0x1123D775 },
    { "./maps/polar07.map", 0x1E331EFD },
    { "./maps/polar08.map", 0x33502955 },
    { "./maps/polar09.map", 0xCA75213B },
    { "./maps/polar10.map", 0x9E02C661 },
    { "./maps/polar11.map", 0xB6F408A7 },
    { "./maps/polar12.map", 0x0E2FB817 },
    { "./maps/polar13.map", 0x163D73F4 },
    { "./maps/pscout.map", 0xFAD5B1F2 },
    { "./maps/temp.map", 0x1D7BF6FC },
    { "./maps/temp1.map", 0x3A6020A0 },
    { "./maps/temp2.map", 0xDE35B7D8 },
    { "./maps/temp3.map", 0x6EA8993E },
    { "./maps/ubase_00.map", 0x195064A5 },
    { "./maps/ubase_01.map", 0x2F09FAC1 },
    { "./maps/ubase_02.map", 0xF980F7DC },
    { "./maps/ubase_03.map", 0x7A5E34F3 },
    { "./maps/ubase_04.map", 0x0D82CAAA },
    { "./maps/ubase_05.map", 0xC12AE454 },
    { "./maps/ubase_06.map", 0xC05721C6 },
    { "./maps/ubase_07.map", 0x59B6CB1F },
    { "./maps/ubase_08.map", 0x1B016351 },
    { "./maps/ubase_09.map", 0x5C695EC4 },
    { "./maps/ubase_10.map", 0x00ED3A3D },
    { "./maps/ubase_11.map", 0x85AEBA17 },
    { "./maps/ubase_12.map", 0x9B7638EF },
    { "./maps/ubase_13.map", 0x9B8DC2B4 },
    { "./maps/ubase_14.map", 0x2C3A4059 },
    { "./maps/ubase_15.map", 0x404B0C29 },
    { "./maps/ufo1a.map", 0x5F788180 },
    { "./maps/ufo1b.map", 0xFE1F28F5 },
    { "./maps/ufo_000.map", 0xBA2E4454 },
    { "./maps/ufo_010.map", 0x1F90ACC5 },
    { "./maps/ufo_110.map", 0x7E619647 },
    { "./maps/ufo_120.map", 0xD984AFC2 },
    { "./maps/ufo_130.map", 0xF1F28B46 },
    { "./maps/ufo_140.map", 0x9F83DFE0 },
    { "./maps/ufo_150.map", 0x43F8FD2A },
    { "./maps/ufo_160.map", 0x3AFDD26E },
    { "./maps/ufo_170.map", 0x67166466 },
    { "./maps/urban00.map", 0x48AC474C },
    { "./maps/urban01.map", 0x8EBF7EF7 },
    { "./maps/urban02.map", 0xF08F43B1 },
    { "./maps/urban03.map", 0x63DCBFF2 },
    { "./maps/urban04.map", 0x53D78D34 },
    { "./maps/urban05.map", 0xFB10288B },
    { "./maps/urban06.map", 0xA0369663 },
    { "./maps/urban07.map", 0xCF2F3944 },
    { "./maps/urban08.map", 0xC4FF21CA },
    { "./maps/urban09.map", 0x5564E786 },
    { "./maps/urban14.map", 0xC8E6A1FC },
    { "./maps/urban15.map", 0xB2F1A43B },
    { "./maps/urban16.map", 0x7C04DFE4 },
    { "./maps/urban17.map", 0xAFE9148F },
    { "./maps/urban18.map", 0x47DD064D },
    { "./maps/xbase_00.map", 0xFCAC7CAB },
    { "./maps/xbase_01.map", 0xFD3FF80E },
    { "./maps/xbase_02.map", 0x55555A21 },
    { "./maps/xbase_03.map", 0xBB18A259 },
    { "./maps/xbase_04.map", 0xD1C7C327 },
    { "./maps/xbase_05.map", 0xE57F0305 },
    { "./maps/xbase_06.map", 0x06384C19 },
    { "./maps/xbase_07.map", 0xCF0F375C },
    { "./maps/xbase_08.map", 0x60B68EBD },
    { "./maps/xbase_09.map", 0xFE97C513 },
    { "./maps/xbase_10.map", 0xD188203C },
    { "./maps/xbase_11.map", 0x90464EA6 },
    { "./maps/xbase_12.map", 0xCF29C157 },
    { "./maps/xbase_13.map", 0x728FAA44 },
    { "./maps/xbase_14.map", 0x3B41AB55 },
    { "./maps/xbase_15.map", 0xE795E758 },
    { "./maps/xbase_16.map", 0x54880A3D },
    { "./maps/xbase_17.map", 0x2C6339EE },
    { "./maps/xbase_18.map", 0xE4C6C6EA },
    { "./maps/xbase_19.map", 0x7C6D6DE3 },
    { "./maps/xbase_20.map", 0x9C834358 },
    { "./terrain/avenger.mcd", 0xECF2680D },
    { "./terrain/avenger.pck", 0x358FF7AA },
    { "./terrain/avenger.tab", 0x3DFFC492 },
    { "./terrain/barn.mcd", 0x41C9C6DA },
    { "./terrain/barn.pck", 0xD7A26A32 },
    { "./terrain/barn.tab", 0xFDFB8499 },
    { "./terrain/blanks.mcd", 0x48458A82 },
    { "./terrain/blanks.pck", 0xD8267D80 },
    { "./terrain/blanks.tab", 0xC3C7CB28 },
    { "./terrain/brain.mcd", 0x82337D7A },
    { "./terrain/brain.pck", 0x632568AF },
    { "./terrain/brain.tab", 0x31869F56 },
    { "./terrain/cultivat.mcd", 0xA8256BDE },
    { "./terrain/cultivat.pck", 0xA89DD052 },
    { "./terrain/cultivat.tab", 0xEC56FB67 },
    { "./terrain/desert.mcd", 0x184ADB39 },
    { "./terrain/desert.pck", 0x71238B43 },
    { "./terrain/desert.tab", 0x8C789EB4 },
    { "./terrain/forest.mcd", 0x0977F8FE },
    { "./terrain/forest.pck", 0x71226E62 },
    { "./terrain/forest.tab", 0x81D8964E },
    { "./terrain/frniture.mcd", 0x2809F743 },
    { "./terrain/frniture.pck", 0x352E8915 },
    { "./terrain/frniture.tab", 0x955520DF },
    { "./terrain/jungle.mcd", 0xE05F7D6B },
    { "./terrain/jungle.pck", 0x56E7F6EF },
    { "./terrain/jungle.tab", 0x6A762B3A },
    { "./terrain/lightnin.mcd", 0x52D586C0 },
    { "./terrain/lightnin.pck", 0xBB583AF4 },
    { "./terrain/lightnin.tab", 0xA2D8586D },
    { "./terrain/mars.mcd", 0x10442761 },
    { "./terrain/mars.pck", 0x4FC379B6 },
    { "./terrain/mars.tab", 0x62BD94B5 },
    { "./terrain/mount.mcd", 0x41ABA2E0 },
    { "./terrain/mount.pck", 0x5713018B },
    { "./terrain/mount.tab", 0x69380138 },
    { "./terrain/plane.mcd", 0x329FE7E3 },
    { "./terrain/plane.pck", 0xCBC507BD },
    { "./terrain/plane.tab", 0xBD1B0109 },
    { "./terrain/polar.mcd", 0x192EE5BC },
    { "./terrain/polar.pck", 0x24B5C3F2 },
    { "./terrain/polar.tab", 0x9BB483AA },
    { "./terrain/roads.mcd", 0xCB51FAB1 },
    { "./terrain/roads.pck", 0x4646E59B },
    { "./terrain/roads.tab", 0x793AA798 },
    { "./terrain/ufo1.mcd", 0x53A40C42 },
    { "./terrain/ufo1.pck", 0x7704BF62 },
    { "./terrain/ufo1.tab", 0xFDE44D96 },
    { "./terrain/urban.mcd", 0xD0F7776E },
    { "./terrain/urban.pck", 0xD650FD32 },
    { "./terrain/urban.tab", 0x710283E0 },
    { "./terrain/urbits.mcd", 0x5561BE75 },
    { "./terrain/urbits.pck", 0x6E4A625D },
    { "./terrain/urbits.tab", 0x1B221FA0 },
    { "./terrain/u_base.mcd", 0x5374B1F9 },
    { "./terrain/u_base.pck", 0x4BF17CD8 },
    { "./terrain/u_base.tab", 0x76E2274C },
    { "./terrain/u_bits.mcd", 0x00000000 }, // Only file existence checked
    { "./terrain/u_bits.pck", 0x0A45F12B },
    { "./terrain/u_bits.tab", 0x916F7813 },
    { "./terrain/u_disec2.mcd", 0xD0084027 },
    { "./terrain/u_disec2.pck", 0x46652039 },
    { "./terrain/u_disec2.tab", 0xDAC474AD },
    { "./terrain/u_ext02.mcd", 0x0D29C496 },
    { "./terrain/u_ext02.pck", 0x4D38F225 },
    { "./terrain/u_ext02.tab", 0xDDF49584 },
    { "./terrain/u_oper2.mcd", 0x7D3188DA },
    { "./terrain/u_oper2.pck", 0x14D80C1B },
    { "./terrain/u_oper2.tab", 0xB0C8E4FF },
    { "./terrain/u_pods.mcd", 0xDAAD4E7A },
    { "./terrain/u_pods.pck", 0x0C4E6B36 },
    { "./terrain/u_pods.tab", 0x10ADF528 },
    { "./terrain/u_wall02.mcd", 0x9CD62870 },
    { "./terrain/u_wall02.pck", 0x90CB2FF3 },
    { "./terrain/u_wall02.tab", 0x199ADE14 },
    { "./terrain/xbase1.mcd", 0x7F92B022 },
    { "./terrain/xbase1.pck", 0x3F980EE5 },
    { "./terrain/xbase1.tab", 0x33A710EC },
    { "./terrain/xbase2.mcd", 0x5E3E3199 },
    { "./terrain/xbase2.pck", 0x1A85898E },
    { "./terrain/xbase2.tab", 0x92200807 },
    { "./ufograph/cursor.pck", 0x69DE75D6 },
    { "./ufograph/cursor.tab", 0xF5FCB568 },
    { "./ufograph/detblob.dat", 0x3569B6D3 },
    { "./ufograph/detbord.pck", 0xB1D72063 },
    { "./ufograph/detbord2.pck", 0xDE760A78 },
    { "./ufograph/hit.pck", 0x29C07717 },
    { "./ufograph/hit.tab", 0x4FF3EE8F },
    { "./ufograph/icons.pck", 0xD407EF95 },
    { "./ufograph/inticon.pck", 0x0BD62FDF },
    { "./ufograph/inticon.tab", 0x2FE8023E },
    { "./ufograph/man_0f0.spk", 0x9B75B5F8 },
    { "./ufograph/man_0f1.spk", 0xB199957A },
    { "./ufograph/man_0f2.spk", 0x8ED17367 },
    { "./ufograph/man_0f3.spk", 0x740442DF },
    { "./ufograph/man_0m0.spk", 0x18B23EF7 },
    { "./ufograph/man_0m1.spk", 0x1B90E3B2 },
    { "./ufograph/man_0m2.spk", 0x17F8E53B },
    { "./ufograph/man_0m3.spk", 0xBC57FC2E },
    { "./ufograph/man_1f0.spk", 0xF87390C0 },
    { "./ufograph/man_1f1.spk", 0x02CB471C },
    { "./ufograph/man_1f2.spk", 0x7E91A5E0 },
    { "./ufograph/man_1f3.spk", 0xF050BD04 },
    { "./ufograph/man_1m0.spk", 0xD919B6A5 },
    { "./ufograph/man_1m1.spk", 0x3AD7592B },
    { "./ufograph/man_1m2.spk", 0x2A0840E1 },
    { "./ufograph/man_1m3.spk", 0x47D7ACCB },
    { "./ufograph/man_2.spk", 0x890C3076 },
    { "./ufograph/man_3.spk", 0xA8BB9C04 },
    { "./ufograph/medibits.dat", 0x00DEF9F9 },
    { "./ufograph/medibord.pck", 0x871634C4 },
    { "./ufograph/scanbord.pck", 0xE3F32D10 },
    { "./ufograph/smoke.pck", 0x65CB2E8E },
    { "./ufograph/smoke.tab", 0xEE8E1054 },
    { "./ufograph/spicons.dat", 0xC71706D7 },
    { "./ufograph/tac00.scr", 0x226E61A0 },
    { "./ufograph/tac01.scr", 0xBBB1E67F },
    { "./ufograph/unibord.pck", 0x94576591 },
    { "./ufograph/x1.pck", 0x6CB3F43D },
    { "./ufograph/x1.tab", 0x606994D3 },
    { "./ufointro/pict2.lbm", 0x783E3C9D },
    { "./ufointro/pict4.lbm", 0x8178ADD1 },
    { "./ufointro/pict5.lbm", 0xA8543964 },
    { "./units/bigobs.pck", 0xBB5FB17D },
    { "./units/bigobs.tab", 0x422CC4A5 },
    { "./units/celatid.pck", 0x99C5D952 },
    { "./units/celatid.tab", 0xB450CFCB },
    { "./units/chrys.pck", 0xCA40A89D },
    { "./units/chrys.tab", 0xE5EA7925 },
    { "./units/civf.pck", 0xBA9955B6 },
    { "./units/civf.tab", 0x449DC508 },
    { "./units/civm.pck", 0x0E4AE803 },
    { "./units/civm.tab", 0x863CBE43 },
    { "./units/cyber.pck", 0xFC0BF3F5 },
    { "./units/cyber.tab", 0xFF00CFF0 },
    { "./units/ethereal.pck", 0x2E750A7C },
    { "./units/ethereal.tab", 0xE8227E28 },
    { "./units/floater.pck", 0xF195F43D },
    { "./units/floater.tab", 0xC3B2729A },
    { "./units/floorob.pck", 0xDF863538 },
    { "./units/floorob.tab", 0x833AC878 },
    { "./units/handob.pck", 0x3EE61F8E },
    { "./units/handob.tab", 0x6EFF9E62 },
    { "./units/muton.pck", 0xD7E169A3 },
    { "./units/muton.tab", 0x91FC80DE },
    { "./units/sectoid.pck", 0xF60F22DC },
    { "./units/sectoid.tab", 0x6831E47A },
    { "./units/silacoid.pck", 0xC6263195 },
    { "./units/silacoid.tab", 0x668C146F },
    { "./units/snakeman.pck", 0x729DC125 },
    { "./units/snakeman.tab", 0x497B94D8 },
    { "./units/tanks.pck", 0x5F3EFF2A },
    { "./units/tanks.tab", 0x4558D63B },
    { "./units/xcom_0.pck", 0x8681EF39 },
    { "./units/xcom_0.tab", 0x68930DB8 },
    { "./units/xcom_1.pck", 0xF03FB73B },
    { "./units/xcom_1.tab", 0xA3839667 },
    { "./units/xcom_2.pck", 0xC49CCBE5 },
    { "./units/xcom_2.tab", 0x528354F7 },
    { "./units/x_reap.pck", 0x6EF04CD0 },
    { "./units/x_reap.tab", 0x0469A2D9 },
    { "./units/x_rob.pck", 0x68F1F014 },
    { "./units/x_rob.tab", 0x63DA3656 },
    { "./units/zombie.pck", 0xF05C3A0B },
    { "./units/zombie.tab", 0x88323A4E }
};

//////////////////////////////////////////////////////////////////////////////
/// Table for calculating crc32                                            ///
//////////////////////////////////////////////////////////////////////////////

unsigned long Crc32Table[256] =
{
    0x00000000, 0x77073096, 0xee0e612c, 0x990951ba,
    0x076dc419, 0x706af48f, 0xe963a535, 0x9e6495a3,
    0x0edb8832, 0x79dcb8a4, 0xe0d5e91e, 0x97d2d988,
    0x09b64c2b, 0x7eb17cbd, 0xe7b82d07, 0x90bf1d91,
    0x1db71064, 0x6ab020f2, 0xf3b97148, 0x84be41de,
    0x1adad47d, 0x6ddde4eb, 0xf4d4b551, 0x83d385c7,
    0x136c9856, 0x646ba8c0, 0xfd62f97a, 0x8a65c9ec,
    0x14015c4f, 0x63066cd9, 0xfa0f3d63, 0x8d080df5,
    0x3b6e20c8, 0x4c69105e, 0xd56041e4, 0xa2677172,
    0x3c03e4d1, 0x4b04d447, 0xd20d85fd, 0xa50ab56b,
    0x35b5a8fa, 0x42b2986c, 0xdbbbc9d6, 0xacbcf940,
    0x32d86ce3, 0x45df5c75, 0xdcd60dcf, 0xabd13d59,
    0x26d930ac, 0x51de003a, 0xc8d75180, 0xbfd06116,
    0x21b4f4b5, 0x56b3c423, 0xcfba9599, 0xb8bda50f,
    0x2802b89e, 0x5f058808, 0xc60cd9b2, 0xb10be924,
    0x2f6f7c87, 0x58684c11, 0xc1611dab, 0xb6662d3d,
    0x76dc4190, 0x01db7106, 0x98d220bc, 0xefd5102a,
    0x71b18589, 0x06b6b51f, 0x9fbfe4a5, 0xe8b8d433,
    0x7807c9a2, 0x0f00f934, 0x9609a88e, 0xe10e9818,
    0x7f6a0dbb, 0x086d3d2d, 0x91646c97, 0xe6635c01,
    0x6b6b51f4, 0x1c6c6162, 0x856530d8, 0xf262004e,
    0x6c0695ed, 0x1b01a57b, 0x8208f4c1, 0xf50fc457,
    0x65b0d9c6, 0x12b7e950, 0x8bbeb8ea, 0xfcb9887c,
    0x62dd1ddf, 0x15da2d49, 0x8cd37cf3, 0xfbd44c65,
    0x4db26158, 0x3ab551ce, 0xa3bc0074, 0xd4bb30e2,
    0x4adfa541, 0x3dd895d7, 0xa4d1c46d, 0xd3d6f4fb,
    0x4369e96a, 0x346ed9fc, 0xad678846, 0xda60b8d0,
    0x44042d73, 0x33031de5, 0xaa0a4c5f, 0xdd0d7cc9,
    0x5005713c, 0x270241aa, 0xbe0b1010, 0xc90c2086,
    0x5768b525, 0x206f85b3, 0xb966d409, 0xce61e49f,
    0x5edef90e, 0x29d9c998, 0xb0d09822, 0xc7d7a8b4,
    0x59b33d17, 0x2eb40d81, 0xb7bd5c3b, 0xc0ba6cad,
    0xedb88320, 0x9abfb3b6, 0x03b6e20c, 0x74b1d29a,
    0xead54739, 0x9dd277af, 0x04db2615, 0x73dc1683,
    0xe3630b12, 0x94643b84, 0x0d6d6a3e, 0x7a6a5aa8,
    0xe40ecf0b, 0x9309ff9d, 0x0a00ae27, 0x7d079eb1,
    0xf00f9344, 0x8708a3d2, 0x1e01f268, 0x6906c2fe,
    0xf762575d, 0x806567cb, 0x196c3671, 0x6e6b06e7,
    0xfed41b76, 0x89d32be0, 0x10da7a5a, 0x67dd4acc,
    0xf9b9df6f, 0x8ebeeff9, 0x17b7be43, 0x60b08ed5,
    0xd6d6a3e8, 0xa1d1937e, 0x38d8c2c4, 0x4fdff252,
    0xd1bb67f1, 0xa6bc5767, 0x3fb506dd, 0x48b2364b,
    0xd80d2bda, 0xaf0a1b4c, 0x36034af6, 0x41047a60,
    0xdf60efc3, 0xa867df55, 0x316e8eef, 0x4669be79,
    0xcb61b38c, 0xbc66831a, 0x256fd2a0, 0x5268e236,
    0xcc0c7795, 0xbb0b4703, 0x220216b9, 0x5505262f,
    0xc5ba3bbe, 0xb2bd0b28, 0x2bb45a92, 0x5cb36a04,
    0xc2d7ffa7, 0xb5d0cf31, 0x2cd99e8b, 0x5bdeae1d,
    0x9b64c2b0, 0xec63f226, 0x756aa39c, 0x026d930a,
    0x9c0906a9, 0xeb0e363f, 0x72076785, 0x05005713,
    0x95bf4a82, 0xe2b87a14, 0x7bb12bae, 0x0cb61b38,
    0x92d28e9b, 0xe5d5be0d, 0x7cdcefb7, 0x0bdbdf21,
    0x86d3d2d4, 0xf1d4e242, 0x68ddb3f8, 0x1fda836e,
    0x81be16cd, 0xf6b9265b, 0x6fb077e1, 0x18b74777,
    0x88085ae6, 0xff0f6a70, 0x66063bca, 0x11010b5c,
    0x8f659eff, 0xf862ae69, 0x616bffd3, 0x166ccf45,
    0xa00ae278, 0xd70dd2ee, 0x4e048354, 0x3903b3c2,
    0xa7672661, 0xd06016f7, 0x4969474d, 0x3e6e77db,
    0xaed16a4a, 0xd9d65adc, 0x40df0b66, 0x37d83bf0,
    0xa9bcae53, 0xdebb9ec5, 0x47b2cf7f, 0x30b5ffe9,
    0xbdbdf21c, 0xcabac28a, 0x53b39330, 0x24b4a3a6,
    0xbad03605, 0xcdd70693, 0x54de5729, 0x23d967bf,
    0xb3667a2e, 0xc4614ab8, 0x5d681b02, 0x2a6f2b94,
    0xb40bbe37, 0xc30c8ea1, 0x5a05df1b, 0x2d02ef8d
};

unsigned long update_crc32(unsigned long InitCrc, void *pInBuff, unsigned long InLen)
{
	unsigned char *_InBuff = (unsigned char *)pInBuff;
	if (InLen != 0) {
		InitCrc = ~ InitCrc;
		while (InLen-- != 0) {
			InitCrc = (InitCrc >> 8) ^ Crc32Table[((unsigned char) InitCrc) ^ (*(_InBuff++))];
		}
		InitCrc = ~InitCrc;
	}
	return InitCrc;
}

/**
 * Function that checks CRC32 of file
 *
 * @param filename name of the file
 * @param crc32    value of CRC32 that file must have
 * @return         true if there are no problems with checked file
 *                 
 * @note           If crc32 argument of function is 0 then only file 
 *                 existence is checked but file content is ignored
 */
bool check_file_crc32(const char *filename, unsigned long crc32)
{
	char buffer[1024];
	FILE *f = FOPEN_ORIG(filename, "rb");
	if (f == NULL) f = FOPEN_OWN(filename, "rb");
	
	if (f == NULL) return false; 
	if (crc32 == 0)	{
		fclose(f);
		return true;
	}
	unsigned long file_crc32 = 0;
	while (true) {
		long size = fread(buffer, 1, sizeof(buffer), f);
		if (size == 0 || ferror(f)) break;
		file_crc32 = update_crc32(file_crc32, buffer, size);
	}
	fclose(f);
	return file_crc32 == crc32;
}


bool get_corrupted_or_missing_files(std::vector<std::string> &result)
{
	std::vector<std::string>::size_type i;
	result.clear();
	for (i = 0; i < sizeof(DataFilesCrc32) / sizeof(DataFilesCrc32[0]); i++)
		if (!check_file_crc32(DataFilesCrc32[i].mName, DataFilesCrc32[i].mCrc32))
			result.push_back(DataFilesCrc32[i].mName);
	return !result.empty();
}
